{% extends 'crud/base_crud.html' %}

{% block crud_content %}
<div class="crud-header">
    <h1>Детали заказа {{ order.order_number }}</h1>
    <div>
        <a href="{% url 'order_list' %}" class="btn-crud btn-view">← Назад к списку</a>
        <a href="{% url 'order_update' order.id %}" class="btn-crud btn-edit">Редактировать</a>
        <a href="{% url 'order_delete' order.id %}" class="btn-crud btn-delete">Удалить</a>
    </div>
</div>

<div class="detail-container">
    <h2>Основная информация</h2>
    <table class="table-crud">
        <tr>
            <th>Номер заказа</th>
            <td><strong>{{ order.order_number }}</strong></td>
        </tr>
        <tr>
            <th>Покупатель</th>
            <td><a href="{% url 'buyer_detail' order.buyer.id %}">{{ order.buyer.get_full_name }}</a></td>
        </tr>
        <tr>
            <th>Продавец</th>
            <td>{% if order.seller %}<a href="{% url 'seller_detail' order.seller.id %}">{{ order.seller.get_full_name }}</a>{% else %}—{% endif %}</td>
        </tr>
        <tr>
            <th>Способ доставки</th>
            <td>{{ order.delivery_method.name }} ({{ order.delivery_method.cost }} руб.)</td>
        </tr>
        <tr>
            <th>Дата и время заказа</th>
            <td>{{ order.order_date|date:"d.m.Y" }} {{ order.order_time|time:"H:i" }}</td>
        </tr>
        <tr>
            <th>Дата и время доставки</th>
            <td>{% if order.delivery_date %}{{ order.delivery_date|date:"d.m.Y" }} {{ order.delivery_time|time:"H:i"|default:"" }}{% else %}Не указано{% endif %}</td>
        </tr>
        <tr>
            <th>Статус</th>
            <td>{{ order.get_status_display }}</td>
        </tr>
        <tr>
            <th>Адрес доставки</th>
            <td>{{ order.delivery_address }}</td>
        </tr>
        <tr>
            <th>Контактный телефон</th>
            <td>{{ order.contact_phone }}</td>
        </tr>
    </table>

    <h3 style="margin-top: 30px;">Финансовые данные</h3>
    <table class="table-crud">
        <tr>
            <th>Сумма заказа</th>
            <td>{{ order.total_amount }} руб.</td>
        </tr>
        <tr>
            <th>Стоимость доставки</th>
            <td>{{ order.delivery_cost }} руб.</td>
        </tr>
        <tr>
            <th>Скидка</th>
            <td>{{ order.discount_percent }}%</td>
        </tr>
        <tr>
            <th><strong>Итого к оплате</strong></th>
            <td><strong>{{ order.get_total_with_discount|floatformat:2 }} руб.</strong></td>
        </tr>
    </table>

    <h3 style="margin-top: 30px;">Позиции заказа ({{ order_items.count }})</h3>
    {% if order_items %}
    <table class="table-crud">
        <thead>
            <tr>
                <th>Товар</th>
                <th>Размер</th>
                <th>Количество</th>
                <th>Цена за единицу</th>
                <th>Скидка</th>
                <th>Подытог</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order_items %}
            <tr>
                <td>{{ item.assortment.name }}</td>
                <td>{{ item.size|default:"—" }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.unit_price }} руб.</td>
                <td>{{ item.discount_percent }}%</td>
                <td><strong>{{ item.get_subtotal|floatformat:2 }} руб.</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>В заказе нет позиций.</p>
    {% endif %}

    {% if order.notes %}
    <h3 style="margin-top: 30px;">Примечания</h3>
    <p>{{ order.notes }}</p>
    {% endif %}
</div>
{% endblock %}

